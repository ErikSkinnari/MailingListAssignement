<%- include('partials/header') %>

<div class="content">

    <div class="headSection flex-h flex-row">
        <div>
            <h1>Admin page</h1>
            <h2>Hello <%= user.username %></h2>
        </div>
        <div>
            <form action="/logout?_method=DELETE" method="post" class="nav-menu-item">
                <% if (!user) { %>

                <% } else {%>
                    <button class="btn btn-register" type="submit">Log Out</button>
                <%}%>
            </form>
        </div>
    </div>
    <br><br>
    <table>
        <thead>
            <tr>
                <th colspan="3"><h2>User list:</h2></th>
            </tr>
            <tr>
                <th>Username</th>
                <th>Email</th>
                <th>Subscribed</th>
            </tr>
        </thead>
        <tbody>
            <% for(let i = 0; i < users.length; i++) { %>
            <tr>
                <th><%= users[i].username %></th>
                <th><%= users[i].email %></th>
                <th><%= users[i].isSubscribed === true ? 'Yes' : 'No' %></th>
            </tr>
            <% } %>
        </tbody>
    </table>
    <br>

    <div class="flex-h">
        <button class="btn btn-register" id="emailListButton">GetEmailList</button>
        <p>Press this lovely button to get a list of email recipients</p>
    </div>
    <!-- The csv-string with email addresses, hidden by default -->
    <div id="emailListDiv" class="hidden">
        <p name="emailListArea" id="emailListArea"><%= csv %></p>
    </div>

</div>

<script>
    let emailListDiv = document.getElementById('emailListDiv');
    let emailListButton = document.getElementById('emailListButton');
    emailListButton.addEventListener('click', () => {
        emailListDiv.classList.toggle('hidden');
    })
</script>

<%- include('partials/footer') %>